!function($,PROBO){"use strict";function ProboSearch(appId,searchKey,indexName,client,index,inputField,submitButton,resetButton,resultsArea,result,resultCount,searchFilter){this.client=algoliasearch(appId,searchKey),this.index=client.initIndex(indexName),this.urlParams=new URLSearchParams(window.location.search),this.inputField=inputField,this.submitButton=submitButton,this.resetButton=resetButton,this.resultsArea=resultsArea,this.result=result,this.resultCount=resultCount,this.searchFilter=searchFilter}PROBO=PROBO||{},ProboSearch.prototype.initialize=function(){var proboSearch=this;$(".search__select").chosen({allow_single_deselect:!0,disable_search_threshold:10,inherit_select_classes:!0,width:"100%"}).change(function(e){proboSearch.updateQuery()}),$(".accordion-nav__item.search").remove(),this.applyUrlValues(this.urlParams),this.getSearchResults(this.urlParams),$(window).keydown(function(event){13==event.keyCode&&(event.preventDefault(),proboSearch.updateQuery())})},ProboSearch.prototype.updateQuery=function(){var filters=this.getFiltersFromSearchForm(),filterString="&";for(var key in filters){filterString+=key+"="+filters[key]+"&"}var oldUrl=window.location.pathname+window.location.search,newUrl="/search/?query="+this.getQueryFromSearchForm()+filterString;newUrl!=oldUrl&&(this.clearSearchResults(),window.history.pushState({},"",newUrl),this.getSearchResults(this.urlParams))},ProboSearch.prototype.applyUrlValues=function(urlParams){this.inputField.val(this.getQueryFromUrl(urlParams));var formFilters=this.getFiltersFromSearchForm(),urlFilters=this.getFiltersFromUrl(urlParams);for(var formFilter in formFilters){var formFilterVal=formFilters[formFilter];for(var urlFilter in urlFilters)if(urlFilter==formFilter){var urlFilterVal=urlFilters[urlFilter];formFilterVal!=urlFilterVal&&$("select[name="+formFilter+"]").val(urlFilterVal).trigger("chosen:updated")}}},ProboSearch.prototype.resetSearch=function(){this.inputField.val(""),$("select").val("").trigger("chosen:updated"),this.updateQuery()},ProboSearch.prototype.clearSearchResults=function(){this.result.remove(),this.resultCount.remove()},ProboSearch.prototype.setResultsMessage=function(message){this.resultsArea.append('<p class="search__results-count">'+message+"</p>")},ProboSearch.prototype.getQueryFromUrl=function(urlParams){return urlParams.get("query")},ProboSearch.prototype.getQueryFromSearchForm=function(){return this.inputField.val()},ProboSearch.prototype.getFiltersFromUrl=function(urlParams){var params=urlParams.entries(),nextParam=params.next().value,filters={};do{"query"!=nextParam[0]&&(filters[nextParam[0]]=nextParam[1]),nextParam=params.next().value}while(void 0!=nextParam);return filters},ProboSearch.prototype.getFiltersFromSearchForm=function(){var filters=this.searchFilter,filtersObj={};return filters.each(function(e){var $categoryId=jQuery("select",this).attr("id"),$filterVal=jQuery(".chosen-container > a:not(.chosen-default) > span",this).text();filtersObj[$categoryId]=$filterVal}),filtersObj},ProboSearch.prototype.filtersToArray=function(filters){var filterArray=[];for(var key in filters){var value=filters[key];filterArray.push(key+":"+value)}return filterArray},ProboSearch.prototype.setTitle=function(title){$(".page-title").replaceWith('<h1 class="page-title">'+title+"</h1>")},ProboSearch.prototype.getSearchResults=function(urlParams){var proboSearch=this,query=this.getQueryFromSearchForm(urlParams),filters=this.filtersToArray(this.getFiltersFromSearchForm(urlParams)),searchObj={query:query,facetFilters:filters};""!=query?this.index.search(searchObj,function(err,content){if(err)return void console.error(err);var resultsLabel=1==content.hits.length?" result":" results",resultsMessage="Showing "+content.hits.length+resultsLabel+' for "'+query+'"';proboSearch.setTitle(resultsMessage);var results=[];for(var h in content.hits){var hit=content.hits[h],searchResult='<div class="search__result"><h2 class="h3 search__result-title"><a href="'+hit.url+'">'+hit.title+'</a></h2><div class="search__result-link">'+document.location.origin+hit.url+'</div><div class="search__result-text">'+hit.text+"</div></div>";results.push(searchResult)}proboSearch.resultsArea.append(results.join(""))}):(this.setTitle("Search"),this.setResultsMessage("You haven't searched for anything yet."))},PROBO.ProboSearch=ProboSearch}(jQuery,PROBO);