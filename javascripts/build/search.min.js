!function($,PROBO){"use strict";function ProboSearch(appId,searchKey,indexName,client,index,inputField,submitButton,resetButton,resultsArea,result,searchFilter){this.client=client,this.index=index,this.urlParams=new URLSearchParams(window.location.search),this.inputField=inputField,this.submitButton=submitButton,this.resetButton=resetButton,this.resultsArea=resultsArea,this.result=result,this.searchFilter=searchFilter,this.searchCacheTimeout=5}PROBO=PROBO||{},ProboSearch.prototype.initialize=function(){var proboSearch=this;this.applyUrlValues(this.urlParams),this.updateQuery(),$(window).keydown(function(event){13==event.keyCode&&(event.preventDefault(),proboSearch.updateQuery())})},ProboSearch.prototype.setDefaultMessage=function(){this.setTitle("Search"),this.setResultsMessage("You haven't searched for anything yet.")},ProboSearch.prototype.updateQuery=function(){var filters=this.getFiltersFromSearchForm(),filterString="&";for(var key in filters){filterString+=key+"="+filters[key]+"&"}var newUrl="/search/?query="+this.getQueryFromSearchForm()+filterString;newUrl&&(this.clearSearchResults(),window.history.pushState({},"",newUrl),this.getSearchResults(this.urlParams,newUrl))},ProboSearch.prototype.applyUrlValues=function(urlParams){this.inputField.val(this.getQueryFromUrl(urlParams));var formFilters=this.getFiltersFromSearchForm(),urlFilters=this.getFiltersFromUrl(urlParams);for(var formFilter in formFilters){var formFilterVal=formFilters[formFilter];for(var urlFilter in urlFilters)if(urlFilter==formFilter){var urlFilterVal=urlFilters[urlFilter];formFilterVal!=urlFilterVal&&$("select[name="+formFilter+"]").val(urlFilterVal).trigger("chosen:updated")}}},ProboSearch.prototype.resetSearch=function(){this.inputField.val(""),$("select").val("").trigger("chosen:updated"),this.updateQuery()},ProboSearch.prototype.clearSearchResults=function(){this.resultsArea.empty()},ProboSearch.prototype.setResultsMessage=function(message){this.resultsArea.append('<p class="search__results-count">'+message+"</p>")},ProboSearch.prototype.getQueryFromUrl=function(urlParams){return urlParams.get("query")},ProboSearch.prototype.getQueryFromSearchForm=function(){return this.inputField.val()},ProboSearch.prototype.getFiltersFromUrl=function(urlParams){var params=urlParams.entries(),nextParam=params.next().value,filters={};do{"query"!=nextParam[0]&&(filters[nextParam[0]]=nextParam[1]),nextParam=params.next().value}while(void 0!=nextParam);return filters},ProboSearch.prototype.getFiltersFromSearchForm=function(){var filters=this.searchFilter,filtersObj={};return filters.each(function(e){var $categoryId=$("select",this).attr("id"),$filterVal=$(".chosen-container > a:not(.chosen-default) > span",this).text();filtersObj[$categoryId]=$filterVal}),filtersObj},ProboSearch.prototype.filtersToArray=function(filters){var filterArray=[];for(var key in filters){var value=filters[key];filterArray.push(key+":"+value)}return filterArray},ProboSearch.prototype.setTitle=function(title){$(".page-title").replaceWith('<h1 class="page-title">'+title+"</h1>")},ProboSearch.prototype.getSearchResults=function(urlParams,newUrl){var proboSearch=this,cache=PROBO.storage.load(newUrl);if(cache)return proboSearch.parseSearchResults(cache);var query=this.getQueryFromSearchForm(urlParams),filters=this.filtersToArray(this.getFiltersFromSearchForm(urlParams)),searchObj={query:query,facetFilters:filters};if(""===query)return this.setDefaultMessage();this.index.search(searchObj,function(err,content){if(!err)return PROBO.storage.save(newUrl,content,proboSearch.searchCacheTimeout),proboSearch.parseSearchResults(content)})},ProboSearch.prototype.parseSearchResults=function(content){if(!content)return this.setDefaultMessage();var resultsLabel=1==content.hits.length?" result":" results",resultsMessage="Showing "+content.hits.length+resultsLabel+' for "'+content.query+'"';this.setTitle(resultsMessage);var results=[];for(var h in content.hits){var hit=content.hits[h],searchResult='<div class="search__result"><h2 class="h3 search__result-title"><a href="'+hit.url+'">'+hit.title+'</a></h2><div class="search__result-link">'+document.location.origin+hit.url+'</div><div class="search__result-text">'+hit.text+"</div></div>";results.push(searchResult)}this.resultsArea.append(results.join(""))},PROBO.ProboSearch=ProboSearch}(jQuery,PROBO),PROBO.storage={save:function(key,jsonData,expirationMin){var expirationMS=60*expirationMin*1e3,record={value:JSON.stringify(jsonData),timestamp:(new Date).getTime()+expirationMS};return localStorage.setItem(key,JSON.stringify(record)),jsonData},load:function(key){var record=JSON.parse(localStorage.getItem(key));return!!record&&((new Date).getTime()<record.timestamp&&JSON.parse(record.value))}};