!function($,PROBO){"use strict";function ProboSearch(appId,searchKey,indexName,client,index,inputField,submitButton,resetButton,resultsArea,result,searchFilter){this.client=client,this.index=index,this.urlParams=new URLSearchParams(window.location.search),this.inputField=inputField,this.submitButton=submitButton,this.resetButton=resetButton,this.resultsArea=resultsArea,this.result=result,this.searchFilter=searchFilter,this.searchCacheTimeout=5}PROBO=PROBO||{},ProboSearch.prototype.initialize=function(){var proboSearch=this;this.applyUrlValues(this.urlParams),this.updateQuery(),$(window).keydown(function(event){13==event.keyCode&&(event.preventDefault(),proboSearch.updateQuery())})},ProboSearch.prototype.setDefaultMessage=function(){this.setTitle("Search"),this.setResultsMessage("You haven't searched for anything yet.")},ProboSearch.prototype.updateQuery=function(){var key,filters=this.getFiltersFromSearchForm(),filterString="&";for(key in filters)filterString+=key+"="+filters[key]+"&";var newUrl="/search/?query="+this.getQueryFromSearchForm()+filterString;newUrl&&(this.clearSearchResults(),window.history.pushState({},"",newUrl),this.getSearchResults(this.urlParams,newUrl))},ProboSearch.prototype.applyUrlValues=function(urlParams){this.inputField.val(this.getQueryFromUrl(urlParams));var formFilter,formFilters=this.getFiltersFromSearchForm(),urlFilters=this.getFiltersFromUrl(urlParams);for(formFilter in formFilters){var urlFilter,urlFilterVal,formFilterVal=formFilters[formFilter];for(urlFilter in urlFilters)urlFilter!=formFilter||formFilterVal!=(urlFilterVal=urlFilters[urlFilter])&&$("select[name="+formFilter+"]").val(urlFilterVal).trigger("chosen:updated")}},ProboSearch.prototype.resetSearch=function(){this.inputField.val(""),$("select").val("").trigger("chosen:updated"),this.updateQuery()},ProboSearch.prototype.clearSearchResults=function(){this.resultsArea.empty()},ProboSearch.prototype.setResultsMessage=function(message){this.resultsArea.append('<p class="search__results-count">'+message+"</p>")},ProboSearch.prototype.getQueryFromUrl=function(urlParams){return urlParams.get("query")},ProboSearch.prototype.getQueryFromSearchForm=function(){return this.inputField.val()},ProboSearch.prototype.getFiltersFromUrl=function(urlParams){for(var params=urlParams.entries(),nextParam=params.next().value,filters={};"query"!=nextParam[0]&&(filters[nextParam[0]]=nextParam[1]),nextParam=params.next().value,null!=nextParam;);return filters},ProboSearch.prototype.getFiltersFromSearchForm=function(){var filters=this.searchFilter,filtersObj={};return filters.each(function(e){var $categoryId=$("select",this).attr("id"),$filterVal=$(".chosen-container > a:not(.chosen-default) > span",this).text();filtersObj[$categoryId]=$filterVal}),filtersObj},ProboSearch.prototype.filtersToArray=function(filters){var key,filterArray=[];for(key in filters){var value=filters[key];filterArray.push(key+":"+value)}return filterArray},ProboSearch.prototype.setTitle=function(title){$(".page-title").replaceWith('<h1 class="page-title">'+title+"</h1>")},ProboSearch.prototype.getSearchResults=function(searchObj,newUrl){var proboSearch=this,query=PROBO.storage.load(newUrl);if(query)return proboSearch.parseSearchResults(query);query=this.getQueryFromSearchForm(searchObj),searchObj={query:query,facetFilters:this.filtersToArray(this.getFiltersFromSearchForm(searchObj))};if(""===query)return this.setDefaultMessage();this.index.search(searchObj,function(err,content){if(!err)return PROBO.storage.save(newUrl,content,proboSearch.searchCacheTimeout),proboSearch.parseSearchResults(content)})},ProboSearch.prototype.parseSearchResults=function(content){if(!content)return this.setDefaultMessage();var resultsMessage=1==content.hits.length?" result":" results",resultsMessage="Showing "+content.hits.length+resultsMessage+' for "'+content.query+'"';this.setTitle(resultsMessage);var h,results=[];for(h in content.hits){var searchResult=content.hits[h],searchResult='<div class="search__result"><h2 class="h3 search__result-title"><a href="'+searchResult.url+'">'+searchResult.title+'</a></h2><div class="search__result-link">'+document.location.origin+searchResult.url+'</div><div class="search__result-text">'+searchResult.excerpt_text+"</div></div>";results.push(searchResult)}this.resultsArea.append(results.join(""))},PROBO.ProboSearch=ProboSearch}(jQuery,PROBO),PROBO.storage={save:function(key,jsonData,record){record=60*record*1e3,record={value:JSON.stringify(jsonData),timestamp:(new Date).getTime()+record};return localStorage.setItem(key,JSON.stringify(record)),jsonData},load:function(record){record=JSON.parse(localStorage.getItem(record));return!!record&&((new Date).getTime()<record.timestamp&&JSON.parse(record.value))}};